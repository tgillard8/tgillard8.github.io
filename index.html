<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix Originals IMDB Scores</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-zoom/1.8.3/d3-zoom.min.js"></script>
</head>
<body>
    <header>
        <h1>Netflix Originals Data Visualization</h1>
    </header>
    
    <main>
        <section>
            <h2>Distribution of IMDB Scores by Top 5 Genres</h2>
            <button id="reset-zoom">Reset Zoom</button>
            <button id="clear-bin">Clear Bin</button>
            <button id="dark-mode-toggle">Toggle Dark Mode</button>
            <div id="chart"></div>
            <div id="tooltip" style="position: absolute; opacity: 0; background-color: white; border: 1px solid #ccc; padding: 8px; border-radius: 4px; pointer-events: none;"></div>
            <div id="bin">
                <h3>Selected Values</h3>
                <ul id="bin-list"></ul>
            </div>
        </section>
    </main>
    
    <script>
        // Load data from CSV file
        d3.csv("netflix.csv").then(function(data) {
            // Parse the data
            data.forEach(function(d) {
                d.score = +d.score; // Convert score to number
            });

            // Declare the chart dimensions and margins
            const width = 800;
            const height = 500;
            const marginTop = 50;
            const marginRight = 30;
            const marginBottom = 70;
            const marginLeft = 50;

            // Declare the x (horizontal position) scale
            const x = d3.scalePoint()
                .domain(data.map(d => d.genre))
                .range([marginLeft, width - marginRight])
                .padding(0.5);

            // Declare the y (vertical position) scale
            const y = d3.scaleLinear()
                .domain([0, 10])
                .range([height - marginBottom, marginTop]);

            // Create the SVG container
            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .call(d3.zoom().on("zoom", (event) => {
                    svgGroup.attr("transform", event.transform);
                }));

            // Create a group for chart elements
            const svgGroup = svg.append("g");

            // Add gradient definition
            svg.append("defs").append("linearGradient")
                .attr("id", "gradient")
                .attr("x1", "0%")
                .attr("y1", "0%")
                .attr("x2", "100%")
                .attr("y2", "100%")
                .selectAll("stop")
                .data([
                    { offset: "0%", color: "#ff7f50" },
                    { offset: "100%", color: "#ff4500" }
                ])
                .enter().append("stop")
                .attr("offset", d => d.offset)
                .attr("stop-color", d => d.color);

            // Add the x-axis
            svgGroup.append("g")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            // Add the y-axis
            svgGroup.append("g")
                .attr("transform", `translate(${marginLeft},0)`)
                .call(d3.axisLeft(y));

            // Tooltip element
            const tooltip = d3.select("#tooltip");

            // Bin list element
            const binList = d3.select("#bin-list");

            // Add the dots with hover and click interaction
            svgGroup.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", d => x(d.genre))
                .attr("cy", d => y(d.score))
                .attr("r", 5)
                .style("fill", "url(#gradient)")
                .style("opacity", 0.7)
                .on("mouseover", (event, d) => {
                    d3.select(event.currentTarget)
                        .transition()
                        .duration(200)
                        .attr("r", 8)
                        .style("fill", "#e50914");
                    tooltip.style("opacity", 1)
                        .html(`ðŸŽ¬ Genre: ${d.genre}<br>â­ Score: ${d.score}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 20) + "px");
                })
                .on("mousemove", (event) => {
                    tooltip.style("left", (event.pageX + 10) + "px")
                           .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", (event) => {
                    d3.select(event.currentTarget)
                        .transition()
                        .duration(200)
                        .attr("r", 5)
                        .style("fill", "url(#gradient)");
                    tooltip.style("opacity", 0);
                })
                .on("click", (event, d) => {
                    const entryText = `Genre: ${d.genre}, Score: ${d.score}`;
                    binList.append("li")
                        .text(entryText)
                        .style("opacity", 0)
                        .transition()
                        .duration(500)
                        .style("opacity", 1);
                });

            // Clear bin functionality
            d3.select("#clear-bin").on("click", () => {
                binList.html("");
                svgGroup.selectAll("circle")
                    .transition()
                    .duration(200)
                    .style("fill", "url(#gradient)")
                    .attr("stroke", "none");
            });

            // Reset zoom functionality
            d3.select("#reset-zoom").on("click", () => {
                svg.transition()
                    .duration(750)
                    .call(d3.zoom().transform, d3.zoomIdentity);
            });
        }).catch(function(error) {
            console.error('Error loading or parsing data:', error);
        });
    </script>
</body>
</html>
